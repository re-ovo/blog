---
title: 波函数坍缩算法
date: 2025-01-09
tags: [算法, 图形]
summary: 波函数坍缩算法是一种用于生成随机迷宫的算法。
draft: true
---

## 简介
最近发现了[Tiny Glade](https://store.steampowered.com/app/2198150/Tiny_Glade/)这个游戏，画风很美，玩法也很有意思。
玩家可以选择材料建造自己喜欢的城堡，游戏会自动连接部件，并且自动添加装饰。虽然玩法很简单，但是非常好奇它是如何实现自动连接部件的。

经过一番搜索，发现这个算法叫做[Wave Function Collapse](https://robertheaton.com/2018/12/17/wavefunction-collapse-algorithm/)

## Wave Function Collapse
> The Wavefunction Collapse Algorithm teaches your computer how to riff. The algorithm takes in an archetypical input, 
> and produces procedurally-generated outputs that look like it.

波函数折叠算法教你的计算机如何即兴演奏。该算法接受原型输入，并生成看起来像它的程序生成的输出。
波函数崩溃是一种非常独立的算法，几乎不需要外部帮助或指令。你向它提供一个你想要的氛围的例子，它会自己计算出其他一切。尽管是自给自足的，但它却非常简单。
它不使用任何神经网络、随机森林或任何其他听起来像机器学习的东西。一旦你明白了这个想法，它就会变得非常干净和直观。

算法的思想非常简单:
给定一个NxM的网格，每个图块(Tile)有K种可能的填充方式，并且每种图块类型都有一组描述每条边的规则。
一旦定义了图块和规则集，您就可以以某种叠加方式收集任何给定位置的所有潜在图块。
然后，您可以迭代这些可能性，并将它们分解为越来越小的可能性空间，这些空间自然地与它们的邻居相适应。

## 现实例子
让我们用拼接地板来理解这个算法。假设你有以下几种地砖：
1. 纯白色地砖
2. 纯黑色地砖
3. 黑白相间的地砖（左白右黑）
4. 黑白相间的地砖（左黑右白）

现在你要铺一个3x3的地板，但有一个规则：相邻地砖的接缝处颜色必须相同。比如：
- 如果使用了左白右黑的地砖，它右边只能放左白右黑的地砖或纯黑色地砖
- 如果使用了纯白色地砖，它右边只能放纯白色地砖或左白右黑的地砖

这就是一个典型的波函数坍缩问题：
1. 初始状态：每个位置都有4种可能的地砖选择
2. 当你确定了第一块地砖后（比如在中间放了一块纯白色地砖）
3. 这个选择会影响周围格子的可能性（比如右边的格子就只能放纯白或左白右黑的地砖了）
4. 依此类推，直到所有格子都确定下来

这个过程就像量子力学中的波函数坍缩：一开始所有状态都是可能的（叠加态），但一旦我们观测（确定）了一个位置，它会影响其他位置的可能性，最终得到一个确定的状态。
